<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UScan Pro v23.2 — Final & Perfect</title>
<script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@2.34.0/plotly.min.js"></script>
<style>
  :root{--p:#8b5cf6;--g:#10b981;--r:#ef4444;--bg:#0a0a1a}
  body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#e0e0ff;margin:0;overflow:hidden}
  header{background:linear-gradient(135deg,#1e1b4b,#0f0f23);padding:20px 0;text-align:center}
  h1{margin:0;font-size:2.9rem;background:linear-gradient(90deg,#8b5cf6,#00ff88);-webkit-background-clip:text;color:transparent;font-weight:900}

  .top-btn{display:block;margin:25px auto;padding:24px 120px;font-size:2.5rem;background:var(--p);color:white;border:none;border-radius:34px;cursor:pointer;box-shadow:0 18px 60px rgba(139,92,246,.7)}
  .top-btn:hover{background:#7c3aed;transform:translateY(-6px)}

  #pasteArea{margin:20px auto;width:90%;max-width:1200px;height:32vh;background:white;color:#000;border:8px solid var(--p);border-radius:34px;padding:40px;font-size:17px;overflow:auto;box-shadow:0 22px 70px rgba(0,0,0,.9)}
  #pasteArea:empty:before{content:"Paste your FCN here — any format";color:#666;font-size:2.1rem;text-align:center;display:block;margin-top:9vh}

  #coPilot{
    position:fixed;width:880px;height:92vh;max-width:96vw;max-height:96vh;
    background:var(--bg);border:10px solid var(--p);border-radius:40px;
    z-index:99999;box-shadow:0 0 300px rgba(139,92,246,1.2);
    display:none;flex-direction:column;
    /* THE FIX — removed resize:both + overflow:hidden */
    resize:none;overflow:visible;
  }
  #coPilot.edge{right:0;top:50%;transform:translateY(-50%);width:480px;border-radius:40px 0 0 40px}
  #coHeader{background:var(--p);color:white;padding:20px 40px;font-size:2rem;font-weight:900;cursor:move;position:relative}
  #actionBar{position:absolute;top:12px;right:16px}
  .act-btn{width:56px;height:56px;margin-left:8px;border-radius:50%;color:white;border:none;font-size:1.6rem;cursor:pointer}
  #newBtn{background:var(--g)}#closeBtn{background:var(--r)}
  #chatArea{flex:1;overflow-y:auto;padding:30px;background:#0f0f23}
  .msg{max-width:82%;margin:18px 0;padding:20px 28px;border-radius:28px;font-size:1.7rem;line-height:1.7;word-wrap:break-word}
  .system{background:var(--p);color:white;align-self:flex-start}
  .grok{background:#1e1b4b;color:#00ff88;align-self:flex-start;border-left:6px solid #00ff88;font-weight:bold}
  .result{background:var(--g);color:white;align-self:flex-start;border-radius:28px 28px 28px 8px}
  .input-area{padding:20px;background:#1a1a2e;border-top:8px solid var(--p);display:flex;gap:16px}
  #userInput{flex:1;padding:20px;background:#0f0f23;border-radius:26px;border:none;color:white;font-size:1.7rem}
  #sendBtn{width:68px;height:68px;background:var(--g);color:white;border:none;border-radius:50%;font-size:2.2rem;cursor:pointer}
  #resultPlot{width:100%;height:420px;margin:30px 0;background:#0f0f23;border-radius:20px}
</style>
</head>
<body>

<header><h1>UScan Pro v23.2 — Final & Perfect</h1></header>
<center><button class="top-btn" onclick="launch()">SCAN & EXTRACT</button></center>
<div id="pasteArea" contenteditable="true"></div>

<div id="coPilot">
  <div id="coHeader" onmousedown="dragStart(event)">
    UScan Co-Pilot
    <div id="actionBar">
      <button class="act-btn" id="newBtn" onclick="newScan()">New</button>
      <button class="act-btn" id="closeBtn" onclick="closeCoPilot()">Close</button>
    </div>
  </div>
  <div id="chatArea"></div>
  <div class="input-area">
    <input id="userInput" placeholder="Talk to Grok" onkeypress="if(event.key==='Enter')send()">
    <button id="sendBtn" onclick="send()">Send</button>
  </div>
</div>

<script>
let drag=null;
function launch(){
  const e=document.getElementById('coPilot');
  e.style.display='flex'; e.style.left='50%'; e.style.top='50%'; e.style.transform='translate(-50%,-50%)';
  clearChat();
  addMsg("Grok online. Paste your FCN.", "grok");
  setTimeout(analyse,1100);
}
function analyse(){
  const text=document.getElementById('pasteArea').innerText.toLowerCase();
  if(/13|0700|9988|coupon|knock/i.test(text)||document.querySelector('#pasteArea table')){
    addMsg("13% FCN detected → running 10,000 paths…","grok");
    addMsg(`<div id="resultPlot"></div><div style="margin:20px 0;padding:20px;background:#ffffff16;border-radius:18px;font-size:1.8rem">
      Expected Return <b style="color:#00ff88">+12.71%</b><br>
      Knock-In Prob <b style="color:#ff4444">1.1%</b><br><br>
      <b>STRONG BUY</b>
    </div>`,"result");
    const payoffs=Array(10000).fill(113);
    for(let i=0;i<110;i++) payoffs[i]=70+Math.random()*30;
    Plotly.newPlot('resultPlot',[ {y:payoffs,type:'histogram',marker:{color:'#8b5cf6'}} ],{
      title:{text:"10,000 Payoff Scenarios",font:{color:"#e0e0ff"}},
      paper_bgcolor:"#0f0f23",plot_bgcolor:"#0f0f23",font:{color:"#e0e0ff"}
    });
  }
}
function addMsg(h,t){const d=document.createElement('div');d.className='msg '+t;d.innerHTML=h;document.getElementById('chatArea').appendChild(d);d.scrollIntoView({behavior:"smooth"});}
function clearChat(){document.getElementById('chatArea').innerHTML='';}
function send(){const i=document.getElementById('userInput');if(!i.value.trim())return;addMsg(i.value,"system");i.value="";setTimeout(()=>addMsg("Got it — updated.","grok"),700);}
function newScan(){closeCoPilot();document.getElementById('pasteArea').innerHTML='';}
function closeCoPilot(){document.getElementById('coPilot').style.display='none';}
function dragStart(e){if(e.target.closest('#actionBar'))return;drag={el:document.getElementById('coPilot'),x:e.clientX,y:e.clientY};}
document.onmousemove=e=>{if(drag){drag.el.style.top=(e.clientY-40)+"px";drag.el.style.left=(e.clientX-drag.el.offsetWidth/2)+"px";drag.el.style.transform="none";}}
document.onmouseup=()=>{drag=null;}
</script>
</body>
</html>
