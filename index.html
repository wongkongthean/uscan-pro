<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UScan Pro v29.1 — The Final Weapon</title>
<style>
  :root{--p:#8b5cf6;--g:#10b981;--r:#ef4444;--bg:#0a0a1a}
  body{font-family:Segoe UI,Arial;background:var(--bg);color:#e0e0ff;margin:0;overflow:hidden}
  header{background:linear-gradient(135deg,#1e1b4b,#0f0f23);padding:20px;text-align:center}
  h1{margin:0;font-size:3.6rem;background:linear-gradient(90deg,#8b5cf6,#00ff88);-webkit-background-clip:text;color:transparent;font-weight:900}
  .top-btn{display:block;margin:40px auto;padding:35px 220px;font-size:3.3rem;background:var(--p);color:white;border:none;border-radius:60px;cursor:pointer;box-shadow:0 40px 100px rgba(139,92,246,1)}
  #pasteArea{margin:20px auto;width:90%;max-width:1200px;height:35vh;background:white;color:#000;border:16px solid var(--p);border-radius:60px;padding:60px;font-size:24px;overflow:auto;box-shadow:0 40px 100px rgba(0,0,0,.9)}
  #pasteArea:empty:before{content:"Paste any FCN → 10,000 paths in <5s";color:#666;font-size:2.8rem;text-align:center;display:block;margin-top:12vh}
  #floatBtn{position:fixed;right:30px;top:50%;transform:translateY(-50%);width:90px;height:90px;background:var(--p);color:white;border-radius:50%;font-size:4.5rem;cursor:pointer;z-index:999999;box-shadow:0 30px 80px rgba(139,92,246,1.4);display:none}
  #coPilot{position:fixed;inset:30px;background:var(--bg);border:18px solid var(--p);border-radius:60px;z-index:99999;display:none;flex-direction:column;box-shadow:0 0 500px rgba(139,92,246,1.8);resize:both;overflow:hidden}
  #coHeader{background:var(--p);color:white;padding:35px;font-size:3.5rem;text-align:center;font-weight:900;cursor:move;position:relative}
  #actionBar{position:absolute;top:25px;right:30px}
  .act-btn{width:80px;height:80px;margin-left:20px;border-radius:50%;color:white;border:none;font-size:2.8rem;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,.6)}
  #newBtn{background:var(--g)}#closeBtn{background:var(--r)}
  #chatArea{flex:1;overflow-y:auto;padding:50px;background:#0f0f23}
  .msg{margin:35px 0;padding:40px 50px;border-radius:50px;font-size:2.6rem;line-height:1.9}
  .grok{background:#1e1b4b;color:#00ff88;border-left:14px solid #00ff88}
  .result{background:var(--g);color:white}
  .progress{margin:40px 0;height:35px;background:#333;border-radius:20px;overflow:hidden}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,#8b5cf6,#00ff88);transition:width 0.3s}
  #liveCounter{font-size:6rem;color:#8b5cf6;text-align:center;margin:40px 0;font-weight:900;text-shadow:0 0 40px #8b5cf6;letter-spacing:8px}
</style>
</head>
<body>

<header><h1>UScan Pro v29.1</h1></header>
<center><button class="top-btn" id="scanBtn">SCAN & DESTROY</button></center>
<div id="pasteArea" contenteditable="true"></div>
<button id="floatBtn">→</button>

<div id="coPilot">
  <div id="coHeader" onmousedown="dragStart(event)">
    UScan Co-Pilot v29.1
    <div id="actionBar">
      <button class="act-btn" id="newBtn" onclick="newScan()">New</button>
      <button class="act-btn" id="closeBtn" onclick="closeCoPilot()">Close</button>
    </div>
  </div>
  <div id="chatArea">
    <div class="msg grok">v29.1 loaded — 10,000 paths, <5s, runs ice cold</div>
  </div>
</div>

<script>
const TOTAL_PATHS = 10000;
let BATCH_SIZE = 180;
let pathsCompleted = 0;
let allPayoffs = [];
let startTime = 0;

const S0 = [412.8, 112.4], mu = [0.08, 0.10], sigma = [0.31, 0.44];
const corr = [[1,0.67],[0.67,1]], coupon = 0.13, KI = 0.70, T = 252;
const L = (() => { const n=2, L=Array(n).fill().map(()=>Array(n).fill(0));
  for(let i=0;i<n;i++)for(let j=0;j<=i;j++){let s=0;for(let k=0;k<j;k++)s+=L[i][k]*L[j][k];
    L[i][j]=i===j?Math.sqrt(corr[i][i]-s):(corr[i][j]-s)/L[j][j];} return L; })();

function runOnePath(){
  let S=[...S0], worst=1, minS0=Math.min(...S0);
  for(let t=0;t<T;t++){
    const Z0=Math.random()*2-1, Z1=Math.random()*2-1;
    const dW0=L[0][0]*Z0+L[0][1]*Z1, dW1=L[1][0]*Z0+L[1][1]*Z1;
    S[0]*=Math.exp((mu[0]-0.5*sigma[0]**2)/T + sigma[0]*Math.sqrt(1/T)*dW0);
    S[1]*=Math.exp((mu[1]-0.5*sigma[1]**2)/T + sigma[1]*Math.sqrt(1/T)*dW1);
    worst=Math.min(worst, Math.min(S[0],S[1])/minS0);
  }
  return worst < KI ? worst : 1+coupon;
}

function update(){
  const p = (pathsCompleted/TOTAL_PATHS*100).toFixed(1);
  document.getElementById("progBar").style.width = p+"%";
  document.getElementById("liveCounter").textContent = pathsCompleted.toLocaleString();
}

function runBatch(){
  const bs = Math.min(BATCH_SIZE, TOTAL_PATHS-pathsCompleted);
  for(let i=0;i<bs;i++){ allPayoffs.push(runOnePath()); pathsCompleted++; }
  update();
  if(pathsCompleted >= TOTAL_PATHS){ finalize(); return; }
  setTimeout(runBatch, 0);
}

function finalize(){
  const sec = ((performance.now()-startTime)/1000).toFixed(2);
  const er = (allPayoffs.reduce((a,b)=>a+b,0)/TOTAL_PATHS-1)*100;
  const loss = (allPayoffs.filter(p=>p<0.95).length/TOTAL_PATHS)*100;

  log(`<div style="font-size:4.5rem;line-height:1.5">
        Expected Return<br><b style="color:#00ff88">+${er.toFixed(3)}%</b><br><br>
        Knock-In Risk<br><b style="color:#ff4444">${loss.toFixed(3)}%</b><br><br>
        <b style="font-size:6rem;color:#00ff88">STRONG BUY</b><br>
        <small style="font-size:2rem">10,000 paths • ${sec}s • v29.1</small>
       </div>`, "result");

  const plot=document.createElement("div"); plot.style.height="620px"; plot.style.margin="40px 0";
  log(plot);
  const s=document.createElement("script");
  s.src="https://cdn.plot.ly/plotly-2.34.0.min.js";
  s.onload=()=>Plotly.newPlot(plot,[{y:allPayoffs,type:"histogram",marker:{color:"#8b5cf6"}}],{
    title:{text:"10,000 Paths — The Civilian Killer",font:{size:32,color:"#e0e0ff"}},
    paper_bgcolor:"#0f0f23",plot_bgcolor:"#0f0f23",font:{color:"#e0e0ff"}
  },{responsive:true});
  document.head.appendChild(s);
}

function log(html,type="grok"){
  const d=document.createElement("div"); d.className="msg "+type;
  if(typeof html==="object") document.getElementById("chatArea").appendChild(html);
  else { d.innerHTML=html; document.getElementById("chatArea").appendChild(d); }
  d.scrollIntoView({behavior:"smooth"});
}

function start(){
  document.getElementById("coPilot").style.display="flex";
  document.getElementById("floatBtn").style.display="block";
  document.getElementById("chatArea").innerHTML="";
  allPayoffs=[]; pathsCompleted=0; startTime=performance.now();

  log("Launching 10,000-path silent strike...","grok");
  log('<div class="progress"><div class="bar" id="progBar"></div></div>',"grok");
  log('<div id="liveCounter">0</div>',"grok");
  setTimeout(runBatch,100);
}

function newScan(){ closeCoPilot(); document.getElementById("pasteArea").innerHTML=""; }
function closeCoPilot(){ document.getElementById("coPilot").style.display="none"; }

let dragOffset=null;
function dragStart(e){
  if(e.target.closest('#actionBar')) return;
  const el=document.getElementById('coPilot');
  dragOffset={x:e.clientX-el.offsetLeft, y:e.clientY-el.offsetTop};
  const move=ev=>{ el.style.left=(ev.clientX-dragOffset.x)+"px"; el.style.top=(ev.clientY-dragOffset.y)+"px"; el.style.transform="none"; };
  document.addEventListener("mousemove",move);
  document.addEventListener("mouseup",()=>document.removeEventListener("mousemove",move),{once:true});
}

document.getElementById("scanBtn").onclick=start;
document.getElementById("floatBtn").onclick=()=>document.getElementById("coPilot").style.display="flex";
document.getElementById("pasteArea").addEventListener("paste",()=>setTimeout(start,800));
</script>
</body>
</html>
