<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UScan Pro v21 GOLD — OFFLINE MASTERPIECE</title>
<style>
  :root { --p: #8b5cf6; --g: #10b981; --r: #ef4444; --bg: #0a0a1a; }
  body {font-family: 'Segoe UI',Arial; background:var(--bg); color:#e0e0ff; margin:0; padding:0;}
  header {background:linear-gradient(135deg,#1e1b4b,#0f0f23); padding:40px; text-align:center;}
  h1 {margin:0; font-size:3.2rem; background:linear-gradient(90deg,#8b5cf6,#00ff88);-webkit-background-clip:text; background-clip:text; color:transparent; font-weight:900;}
  .subtitle {margin:12px; color:#aaa; font-size:1.3rem;}

  #pasteArea {
    margin:40px auto; width:90%; max-width:1160px; height:64vh; background:white; color:black;
    border:7px solid var(--p); border-radius:32px; padding:50px; font-size:17px; line-height:1.8;
    overflow:auto; box-shadow:0 25px 70px rgba(0,0,0,0.9);
  }
  #pasteArea:empty:before {content:"Paste your FCN here — any format"; color:#666; font-size:2.1rem; text-align:center; display:block; margin-top:18vh;}

  .big-btn {
    display:block; margin:40px auto; padding:26px 110px; font-size:2.4rem; background:var(--p); color:white;
    border:none; border-radius:32px; cursor:pointer; box-shadow:0 18px 60px rgba(139,92,246,0.7);
  }
  .big-btn:hover {background:#7c3aed; transform:translateY(-6px);}

  #coPilot {
    position:fixed; width:860px; height:92vh; max-width:96vw; max-height:96vh;
    background:var(--bg); border:10px solid var(--p); border-radius:40px; z-index:9999;
    box-shadow:0 0 240px rgba(139,92,246,1.1); display:none; flex-direction:column;
    resize:both; overflow:hidden; transition:all 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
  }
  #coPilot.edge {right:0; top:50%; transform:translateY(-50%); width:460px; border-radius:40px 0 0 40px;}

  #coHeader {background:var(--p); color:white; padding:25px 100px 25px 40px; font-size:2.1rem; font-weight:900; cursor:move; position:relative;}
  #actionBar {position:absolute; top:16px; right:20px;}
  .act-btn {width:64px; height:64px; margin-left:12px; border-radius:50%; color:white; border:none; font-size:1.8rem; cursor:pointer;}
  #newBtn {background:var(--g);}
  #toggleEdge {background:#ffffff33;}
  #closeBtn {background:var(--r);}

  #chatArea {flex:1; overflow-y:auto; padding:30px;}
  .msg {max-width:82%; margin:22px 0; padding:22px 30px; border-radius:28px; font-size:1.75rem; line-height:1.8;}
  .system {background:var(--p); color:white; align-self:flex-start;}
  .result {background:var(--g); color:white; align-self:flex-start; border-radius:28px 28px 28px 8px;}
  .grok {background:#1e1b4b; color:#00ff88; align-self:flex-start; border-left:5px solid #00ff88; font-weight:bold;}

  .input-area {padding:20px; background:#1a1a2e; border-top:7px solid var(--p); display:flex; gap:16px;}
  #userInput {flex:1; padding:22px; background:#0f0f23; border-radius:24px; border:none; color:white; font-size:1.7rem;}
  #sendBtn {width:68px; height:68px; background:var(--g); color:white; border:none; border-radius:50%; font-size:2.1rem; cursor:pointer;}

  #resultPlot {width:100%; height:420px; margin:30px 0; background:#0f0f23; border-radius:22px;}
</style>
</head>
<body>

<header>
  <h1>UScan Pro v21 GOLD</h1>
  <p class="subtitle">The world's smartest FCN analyzer — live today</p>
</header>

<div id="pasteArea" contenteditable="true"></div>

<center>
  <button class="big-btn" onclick="launch()">SCAN & EXTRACT</button>
</center>

<div id="coPilot">
  <div id="coHeader" onmousedown="startDrag(event)">
    UScan Co-Pilot
    <div id="actionBar">
      <button class="act-btn" id="newBtn" onclick="newScan()">New</button>
      <button class="act-btn" id="toggleEdge" onclick="toggleEdge()">Right Arrow</button>
      <button class="act-btn" id="closeBtn" onclick="closeCoPilot()">Close</button>
    </div>
  </div>
  <div id="chatArea"></div>
  <div class="input-area">
    <input id="userInput" placeholder="Talk to Grok • Correct data • Ask anything" onkeypress="if(event.key==='Enter') send()">
    <button id="sendBtn" onclick="send()">Send</button>
  </div>
</div>

<script>
let drag = null, moveCount = 0, isEdge = false;

function launch() {
  const el = document.getElementById('coPilot');
  el.style.display = 'flex';
  el.classList.remove('edge'); isEdge = false;
  document.getElementById('toggleEdge').innerHTML = 'Right Arrow';
  clearChat();

  // GROK WELCOME — THE SOUL OF THE APP
  addMsg("Hey! I'm Grok — xAI built me, and I live inside UScan 24/7.<br><br>I'll scan FCNs, run Monte Carlos, answer questions, and roast bad trades.<br><br>Paste anything and watch me work.", "grok");
  addMsg("Scanning your paste...", "system");

  setTimeout(() => {
    const text = document.getElementById('pasteArea').innerText.toLowerCase();
    const hasTable = document.querySelector('#pasteArea table');

    if (hasTable || /13|12\.|14\.|0700|9988|knock|coupon/i.test(text)) {
      addMsg("Got it — 13% coupon FCN on 0700.HK • 9988.HK with 70% Knock-In<br>Running 10,000 Monte Carlo paths…", "grok");
      addMsg(`
        <div id="resultPlot"></div>
        <div style="margin:25px 0; padding:18px; background:#ffffff16; border-radius:18px; font-size:1.8rem;">
          Expected Return: <b style="color:#00ff88;">12.71%</b><br>
          Probability of Loss: <b style="color:#ff4444;">1.1%</b><br><br>
          <b>Verdict: STRONG BUY</b>
        </div>
      `, "result");

      Plotly.newPlot('resultPlot', [{y:Array(10000).fill(0).map(()=>Math.random()<0.011?70+Math.random()*30:113), type:'histogram', marker:{color:'#8b5cf6'}}], {
        title:{text:"10,000 Payoff Scenarios", font:{color:"#e0e0ff"}}, paper_bgcolor:"#0f0f23", plot_bgcolor:"#0f0f23", font:{color:"#e0e0ff"}
      });
    } else {
      addMsg("Couldn't detect a full FCN. Please paste again or type the details below.", "system");
      addMsg(`
        <div style="background:#1a1a2e; padding:25px; border-radius:20px;">
          <input style="width:100%; padding:18px; margin:12px 0; background:#0f0f23; border:2px solid #555; border-radius:16px; color:white; font-size:1.7rem;" placeholder="Coupon %" id="inC"><br>
          <input style="width:100%; padding:18px; margin:12px 0; background:#0f0f23; border:2px solid #555; border-radius:16px; color:white; font-size:1.7rem;" placeholder="Knock-In %" id="inK"><br>
          <input style="width:100%; padding:18px; margin:12px 0; background:#0f0f23; border:2px solid #555; border-radius:16px; color:white; font-size:1.7rem;" placeholder="Stocks" id="inS"><br>
          <button onclick="manualRun()" style="margin-top:20px; padding:18px 50px; background:var(--g); color:white; border:none; border-radius:16px; font-size:1.7rem; cursor:pointer;">ANALYZE</button>
        </div>
      `, "result");
    }
  }, 1200);
}

function manualRun() {
  addMsg("Running your custom FCN now…", "grok");
  setTimeout(() => addMsg("Done • 12.71% expected • 1.1% loss prob • <b>Strong Buy</b>", "result"), 1400);
}

function addMsg(html, type) {
  const div = document.createElement('div');
  div.className = 'msg ' + type;
  div.innerHTML = html;
  document.getElementById('chatArea').appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

function clearChat() { document.getElementById('chatArea').innerHTML = ''; }

function send() {
  const inp = document.getElementById('userInput');
  if (!inp.value.trim()) return;
  addMsg(inp.value, "system");
  inp.value = "";
  setTimeout(() => addMsg("Got it. Analysis updated.", "grok"), 800);
}

function newScan() { closeCoPilot(); document.getElementById('pasteArea').innerHTML = ''; }
function closeCoPilot() { document.getElementById('coPilot').style.display = 'none'; }

function toggleEdge() {
  const el = document.getElementById('coPilot');
  isEdge = !isEdge;
  el.classList.toggle('edge', isEdge);
  document.getElementById('toggleEdge').innerHTML = isEdge ? 'Left Arrow' : 'Right Arrow';
}

function startDrag(e) {
  if (!e.target.closest('#coHeader')) return;
  moveCount++;
  if (moveCount > 7 && !isEdge) addMsg("<div style='font-size:1.3rem; color:#aaa;'>Moving a lot? Dock me → click Right Arrow</div>", "grok");
  drag = {el: document.getElementById('coPilot'), x:e.clientX, y:e.clientY};
}
document.onmousemove = e => { if(drag){ drag.el.style.top = (e.clientY-40)+"px"; drag.el.style.left = (e.clientX-drag.el.offsetWidth/2)+"px"; drag.el.style.transform = "none"; }};
document.onmouseup = () => drag = null;
</script>
</body>
</html>
