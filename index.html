<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UScan Pro v28 — The Quiet Killer</title>
<style>
  body{margin:0;font-family:Segoe UI;background:#0a0a1a;color:#0f0;overflow:hidden}
  header{background:#1e1b4b;padding:25px;text-align:center}
  h1{font-size:3.5rem;margin:0;background:linear-gradient(90deg,#8b5cf6,#00ff88);-webkit-background-clip:text;color:transparent}
  #scanBtn{display:block;margin:40px auto;padding:30px 180px;font-size:3rem;background:#8b5cf6;color:white;border:none;border-radius:50px;cursor:pointer;box-shadow:0 30px 80px rgba(139,92,246,.9)}
  #pasteArea{margin:20px auto;width:90%;max-width:1200px;height:35vh;background:white;color:#000;border:12px solid #8b5cf6;border-radius:50px;padding:50px;font-size:20px;overflow:auto}
  #pasteArea:empty:before{content:"Paste any FCN — we destroy in silence";color:#999;font-size:2.5rem;text-align:center;display:block;margin-top:12vh}
  #coPilot{position:fixed;inset:30px;background:#0f0f23;border:15px solid #8b5cf6;border-radius:50px;z-index:99999;display:none;flex-direction:column;box-shadow:0 0 400px rgba(139,92,246,1.5)}
  #coHeader{background:#8b5cf6;color:white;padding:30px;font-size:3rem;text-align:center;font-weight:900}
  #chatArea{flex:1;overflow-y:auto;padding:40px;background:#0f0f23}
  .msg{margin:25px 0;padding:30px 40px;border-radius:40px;font-size:2.2rem;line-height:1.8}
  .grok{background:#1e1b4b;color:#00ff88;border-left:12px solid #00ff88}
  .result{background:#10b981;color:white}
  .progress{margin:30px 0;height:25px;background:#333;border-radius:15px;overflow:hidden}
  .bar{height:100%;width:0%;background:#8b5cf6;transition:width 0.4s}
</style>
</head>
<body>

<header><h1>UScan Pro v28</h1></header>
<center><button id="scanBtn">SCAN & EXTRACT</button></center>
<div id="pasteArea" contenteditable="true"></div>

<div id="coPilot">
  <div id="coHeader">UScan Co-Pilot</div>
  <div id="chatArea">
    <div class="msg grok">v28 loaded — silent, lethal, unstoppable</div>
  </div>
</div>

<script>
// === CONFIG ===
const TOTAL_PATHS = 10000;
const BASE_BATCH = 100;  // will auto-adjust based on device speed
let BATCH_SIZE = BASE_BATCH;
let pathsCompleted = 0;
let allPayoffs = [];

// === CORRELATION & MARKET DATA (updated Nov 2025) ===
const S0 = [412.8, 112.4];  // Tencent, Alibaba
const mu = [0.08, 0.10];
const sigma = [0.31, 0.44];
const corr = [[1, 0.67], [0.67, 1]];
const coupon = 0.13;
const KI = 0.70;
const T = 252;

// Pre-compute Cholesky once
function cholesky(A) {
  const n = A.length, L = Array(n).fill().map(()=>Array(n).fill(0));
  for (let i = 0; i < n; i++)
    for (let j = 0; j <= i; j++) {
      let s = 0;
      for (let k = 0; k < j; k++) s += L[i][k] * L[j][k];
      L[i][j] = i === j ? Math.sqrt(A[i][i] - s) : (A[i][j] - s) / L[j][j];
    }
  return L;
}
const L = cholesky(corr);

function runOnePath() {
  let S = [...S0];
  let worst = 1;
  const minS0 = Math.min(...S0);
  for (let t = 0; t < T; t++) {
    const Z = [Math.random()*2-1, Math.random()*2-1];
    const dW = [
      L[0][0]*Z[0] + L[0][1]*Z[1],
      L[1][0]*Z[0] + L[1][1]*Z[1]
    ];
    for (let k = 0; k < 2; k++) {
      S[k] *= Math.exp((mu[k] - 0.5*sigma[k]**2)/T + sigma[k]*Math.sqrt(1/T)*dW[k]);
    }
    worst = Math.min(worst, Math.min(...S) / minS0);
  }
  return worst < KI ? worst : 1 + coupon;
}

function updateProgress() {
  const percent = (pathsCompleted / TOTAL_PATHS * 100).toFixed(1);
  const bar = document.getElementById("progBar");
  if (bar) bar.style.width = percent + "%";
  document.getElementById("progText").textContent = `${pathsCompleted.toLocaleString()} / ${TOTAL_PATHS} paths (${percent}%)`;
}

function runBatch() {
  const start = performance.now();
  const thisBatch = Math.min(BATCH_SIZE, TOTAL_PATHS - pathsCompleted);
  
  for (let i = 0; i < thisBatch; i++) {
    allPayoffs.push(runOnePath());
    pathsCompleted++;
  }
  
  updateProgress();
  
  if (pathsCompleted >= TOTAL_PATHS) {
    finalize();
    return;
  }
  
  // Auto-adjust batch size based on speed
  const elapsed = performance.now() - start;
  if (elapsed > 16) BATCH_SIZE = Math.max(10, Math.floor(BATCH_SIZE * 0.7));  // slow device
  else if (elapsed < 8) BATCH_SIZE = Math.min(500, Math.floor(BATCH_SIZE * 1.5)); // fast device
  
  setTimeout(runBatch, 0);  // yield to UI
}

function finalize() {
  const er = (allPayoffs.reduce((a,b)=>a+b,0)/TOTAL_PATHS - 1) * 100;
  const loss = (allPayoffs.filter(p => p < 0.95).length / TOTAL_PATHS) * 100;
  
  log(`Expected Return: <b style="color:#00ff88">+${er.toFixed(2)}%</b><br>
       Knock-In Risk: <b style="color:#ff4444">${loss.toFixed(2)}%</b><br><br>
       <b style="font-size:3rem">STRONG BUY — LOAD IT</b>`, "result");
  
  const plot = document.createElement("div");
  plot.style.height = "560px";
  log(plot.outerHTML);
  
  const s = document.createElement("script");
  s.src = "https://cdn.plot.ly/plotly-2.34.0.min.js";
  s.onload = () => Plotly.newPlot(plot, [{y: allPayoffs, type:"histogram", marker:{color:"#8b5cf6"}}], {
    title: {text: "10,000 Silent Paths — v28", font:{color:"#e0e0ff"}},
    paper_bgcolor: "#0f0f23", plot_bgcolor: "#0f0f23", font:{color:"#e0e0ff"}
  }, {responsive:true});
  document.head.appendChild(s);
}

function log(html, type="grok") {
  const div = document.createElement("div");
  div.className = "msg " + type;
  div.innerHTML = html;
  document.getElementById("chatArea").appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

function startMC() {
  document.getElementById("coPilot").style.display = "flex";
  document.getElementById("chatArea").innerHTML = "";
  allPayoffs = []; pathsCompleted = 0; BATCH_SIZE = BASE_BATCH;
  
  log("Running 10,000-path silent Monte Carlo...", "grok");
  log('<div class="progress"><div class="bar" id="progBar"></div></div><div id="progText" style="text-align:center;margin:20px;font-size:1.8rem">0 / 10,000 paths (0%)</div>', "grok");
  
  setTimeout(runBatch, 100);
}

document.getElementById("scanBtn").onclick = startMC;
document.getElementById("pasteArea").addEventListener("paste", () => setTimeout(startMC, 800));
</script>
</body>
</html>
